{"version":3,"file":"cnfapi-mini-vs.esm.js","sources":["../node_modules/@babel/runtime/helpers/defineProperty.js","../src/lib/index.js"],"sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","import Api from 'cnfapi-miniprogram';\nimport { defaultSign } from 'mksign';\n\n// eslint-disable-next-line\nexport default function(\n  {\n    baseURL = '',\n    env = 'weapp',\n    appKey = '',\n    appCode = '',\n    apiList,\n    resInterceptor,\n    openResInterceptor,\n    resSuccessCallback,\n    headers = {\n      'Content-Type': 'application/json',\n    },\n  } = { apiList: {} },\n) {\n  const api = new Api({\n    baseURL,\n    env, // 使用环境：weapp - 微信小程序、aliapp - 支付宝小程序、swan - 百度小程序\n    timeout: 10000, // 10s超时\n    headers,\n    resSuccessCallback(data, next) {\n      if (resSuccessCallback && typeof resSuccessCallback === 'function') {\n        return resSuccessCallback(data, next);\n      }\n      if (data.retcode === 200) {\n        return next(null, data.data, data.retcode);\n      }\n      return next({\n        msg: data.msg,\n        retcode: data.retcode,\n      }, {}, data.retcode);\n    },\n    openResInterceptor(res) {\n      if (typeof openResInterceptor === 'function') {\n        return openResInterceptor.call(this, res);\n      }\n      return false;\n    },\n    resInterceptor(serverData, next) {\n      if (typeof resInterceptor === 'function') {\n        return resInterceptor.bind(this)(serverData, next);\n      }\n      return next();\n    },\n  }, apiList);\n\n  // eslint-disable-next-line\n  api._before = function apiBefore(apiOpts, apiConf, next) {\n    const { signKeys } = apiConf,\n      signData = {};\n    let { data } = apiOpts;\n    if (!data) {\n      data = {};\n    }\n    data.app_key = appKey;\n    Object.keys(data).forEach((item) => {\n      if (signKeys.indexOf(item) > -1) {\n        if (data[item] || data[item] === 0) {\n          signData[item] = data[item];\n        }\n      }\n    });\n    try {\n      data.sign = defaultSign(signData, [appCode]);\n    } catch (e) {\n      console.error(e);\n      data.sign = '';\n    }\n    next({\n      ...apiOpts,\n      data,\n    });\n  };\n\n  return api;\n}\n"],"names":["apiList","baseURL","env","appKey","appCode","resInterceptor","openResInterceptor","resSuccessCallback","headers","api","Api","timeout","data","next","retcode","msg","res","call","serverData","bind","_before","apiOpts","apiConf","signKeys","signData","app_key","Object","keys","forEach","item","indexOf","sign","defaultSign","e","console","error"],"mappings":"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"}