{"version":3,"file":"cnfapi-mini-vs.common.js","sources":["../node_modules/@babel/runtime/helpers/defineProperty.js","../src/lib/index.js"],"sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nmodule.exports = _defineProperty;","import Api from 'cnfapi-miniprogram';\nimport { defaultSign } from 'mksign';\n\n// eslint-disable-next-line\nexport default function(\n  {\n    baseURL = '',\n    env = 'weapp',\n    appKey = '',\n    appCode = '',\n    apiList,\n    resInterceptor,\n    openResInterceptor,\n    resSuccessCallback,\n    headers = {\n      'Content-Type': 'application/json',\n    },\n  } = { apiList: {} },\n) {\n  const api = new Api({\n    baseURL,\n    env, // 使用环境：weapp - 微信小程序、aliapp - 支付宝小程序、swan - 百度小程序\n    timeout: 10000, // 10s超时\n    headers,\n    resSuccessCallback(data, next) {\n      if (resSuccessCallback && typeof resSuccessCallback === 'function') {\n        return resSuccessCallback(data, next);\n      }\n      if (data.retcode === 200) {\n        return next(null, data.data, data.retcode);\n      }\n      return next({\n        msg: data.msg,\n        retcode: data.retcode,\n      }, {}, data.retcode);\n    },\n    openResInterceptor(res) {\n      if (typeof openResInterceptor === 'function') {\n        return openResInterceptor.call(this, res);\n      }\n      return false;\n    },\n    resInterceptor(serverData, next) {\n      if (typeof resInterceptor === 'function') {\n        return resInterceptor.bind(this)(serverData, next);\n      }\n      return next();\n    },\n  }, apiList);\n\n  // eslint-disable-next-line\n  api._before = function apiBefore(apiOpts, apiConf, next) {\n    const { signKeys } = apiConf,\n      signData = {};\n    let { data } = apiOpts;\n    if (!data) {\n      data = {};\n    }\n    data.app_key = appKey;\n    Object.keys(data).forEach((item) => {\n      if (signKeys.indexOf(item) > -1) {\n        if (data[item] || data[item] === 0) {\n          signData[item] = data[item];\n        }\n      }\n    });\n    try {\n      data.sign = defaultSign(signData, [appCode]);\n    } catch (e) {\n      console.error(e);\n      data.sign = '';\n    }\n    next({\n      ...apiOpts,\n      data,\n    });\n  };\n\n  return api;\n}\n"],"names":["obj","key","value","Object","defineProperty","enumerable","configurable","writable","apiList","baseURL","env","appKey","appCode","resInterceptor","openResInterceptor","resSuccessCallback","headers","api","Api","timeout","Content-Type","data","next","retcode","msg","res","call","this","serverData","bind","_before","apiOpts","apiConf","signKeys","signData","app_key","keys","forEach","item","indexOf","sign","defaultSign","e","console","error"],"mappings":"wbAeA,MAfA,SAAyBA,EAAKC,EAAKC,GAYjC,OAXID,KAAOD,EACTG,OAAOC,eAAeJ,EAAKC,EAAK,CAC9BC,MAAOA,EACPG,YAAY,EACZC,cAAc,EACdC,UAAU,IAGZP,EAAIC,GAAOC,EAGNF,8SCKH,CAAEQ,QAAS,QAXbC,QAAAA,aAAU,SACVC,IAAAA,aAAM,cACNC,OAAAA,aAAS,SACTC,QAAAA,aAAU,KACVJ,IAAAA,QACAK,IAAAA,eACAC,IAAAA,mBACAC,IAAAA,uBACAC,QAKIC,EAAM,IAAIC,EAAI,CAClBT,QAAAA,EACAC,IAAAA,EACAS,QAAS,IACTH,mBATU,CACRI,eAAgB,sBASlBL,4BAAmBM,EAAMC,UACnBP,GAAoD,mBAAvBA,EACxBA,EAAmBM,EAAMC,GAEb,MAAjBD,EAAKE,QACAD,EAAK,KAAMD,EAAKA,KAAMA,EAAKE,SAE7BD,EAAK,CACVE,IAAKH,EAAKG,IACVD,QAASF,EAAKE,SACb,GAAIF,EAAKE,UAEdT,4BAAmBW,SACiB,mBAAvBX,GACFA,EAAmBY,KAAKC,KAAMF,IAIzCZ,wBAAee,EAAYN,SACK,mBAAnBT,EACFA,EAAegB,KAAKF,KAApBd,CAA0Be,EAAYN,GAExCA,MAERd,GA8BH,OA3BAS,EAAIa,QAAU,SAAmBC,EAASC,EAASV,OACzCW,EAAaD,EAAbC,SACNC,EAAW,GACPb,EAASU,EAATV,KACDA,IACHA,EAAO,IAETA,EAAKc,QAAUxB,EACfR,OAAOiC,KAAKf,GAAMgB,QAAQ,SAACC,IACK,EAA1BL,EAASM,QAAQD,KACfjB,EAAKiB,IAAwB,IAAfjB,EAAKiB,MACrBJ,EAASI,GAAQjB,EAAKiB,MAI5B,IACEjB,EAAKmB,KAAOC,cAAYP,EAAU,CAACtB,IACnC,MAAO8B,GACPC,QAAQC,MAAMF,GACdrB,EAAKmB,KAAO,GAEdlB,8UACKS,GACHV,KAAAA,MAIGJ"}